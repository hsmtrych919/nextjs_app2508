# サテライト投資管理アプリ UI問題分析＆修正計画書

## 📋 現状分析レポート

### 🔴 重大な問題点

#### 1. **画面構成が仕様書と完全に乖離**
**仕様書要求**:
```
1. 上部: フォーメーション選択
2. 中部: Tier別銘柄入力セクション（フォーメーション選択により動的変更）
3. 下部: 予算管理エリア（Funds, Start, Profit, Return%）
4. 最下部: Formation Usage表示
```

**現在の実装**:
```
1. 上部: データ読み込み/保存/自動保存ON/OFF（意味不明なAPI操作）
2. 中部: 予算情報（読み取り専用表示のみ）
3. 下部: フォーメーション選択（ボタンでパーセンテージ表示のみ）
4. 最下部: フォーメーション使用統計
```

#### 2. **メイン機能が完全に欠落**
- ❌ **Tier別銘柄入力**: 存在しない
- ❌ **ティッカー選択**: 存在しない
- ❌ **Entry価格・Hold株数入力**: 存在しない
- ❌ **Goal株数自動計算・Hold/Goal表示**: 存在しない
- ❌ **予算管理入力**: 読み取り専用で入力不可

#### 3. **不要な機能が追加されている**
- ❌ **手動データ読み込み/保存ボタン**: 仕様にない
- ❌ **自動保存ON/OFFスイッチ**: 仕様にない
- ❌ **ローディング・エラー表示**: 過剰実装

#### 4. **コンポーネント構造の問題**
- ✅ `StockInput.tsx`は存在するが、`index.tsx`で使用されていない
- ✅ 型定義は整備されているが、実際のUI実装で活用されていない
- ✅ ティッカー定数も準備されているが、UI画面に反映されていない

### 🔍 原因分析

#### AI実装の勘違いポイント
1. **API中心設計の誤解**: バックエンドAPI統合に注力し、フロントエンドUIの仕様実装を軽視
2. **開発用ツールの混入**: 開発効率を上げるつもりで手動保存機能などを勝手に追加
3. **段階的実装の失敗**: UI基盤だけ作って、メイン機能を後回しにした結果、実装されずに終了
4. **コンポーネント分離の問題**: `StockInput`を作成したが、メインページで統合していない

#### Agent分担計画との整合性問題
- **Agent1責任範囲**: フロントエンド・UI・状態管理
- **実際の状況**: API統合部分だけ実装され、UI部分が未実装

## 🎯 修正計画

### Phase 1: 画面構成の完全再構築 【優先度: 最高】

#### 1.1 `pages/index.tsx`の根本的修正
```tsx
// 現在の間違った構成を削除:
- APIコントロール（データ読み込み、データ保存、自動保存ON/OFF）
- 読み取り専用の予算表示

// 正しい仕様書準拠の構成に変更:
+ FormationSelector（フォーメーション選択）
+ StockInput（Tier別銘柄入力 - 既存コンポーネント活用）
+ BudgetManager（予算管理 - 入力可能な形式）
+ FormationUsage（使用統計 - シンプル表示）
```

#### 1.2 コンポーネント統合実装
```tsx
// メインページでの統合
<FormationSelector />
{selectedFormation && (
  <StockInput tiers={selectedFormation.tiers} />
)}
<BudgetManager />
<FormationUsage />
```

### Phase 2: 既存コンポーネントの修正・活用 【優先度: 高】

#### 2.1 `StockInput.tsx`の修正
**現状**: 作成済みだが複雑すぎる実装
**修正内容**:
- Tier表示の簡略化
- 入力フォームの使いやすさ向上
- Goal株数計算の視覚的表示改善

#### 2.2 `BudgetManager.tsx`の新規作成
**仕様**:
```tsx
// 入力項目
- Funds: 総予算（デフォルト6000、変更可能）
- Start: スタート地点金額
- Profit: 利確額
// 自動計算表示
- Return: 年利％
```

#### 2.3 `FormationSelector.tsx`の新規作成
**仕様**:
```tsx
// Radix UI Select使用
// 選択により下部Tier数が動的変更
// フォーメーション定義との連携
```

### Phase 3: データフロー最適化 【優先度: 中】

#### 3.1 不要なAPI機能の削除
```tsx
// 削除対象
- 手動データ読み込み/保存ボタン
- 自動保存ON/OFFスイッチ
- 過剰なローディング・エラー表示

// 保持するAPI機能
- バックグラウンドでの自動保存（ユーザーには非表示）
- 初期データ読み込み（ユーザーには非表示）
```

#### 3.2 状態管理の整理
```tsx
// Zustandストア最適化
- API関連の状態を内部化
- UIに必要な状態のみ公開
- 過剰な型変換ロジックの簡略化
```

### Phase 4: UI/UX改善 【優先度: 中】

#### 4.1 画面レイアウト調整
- 仕様書通りの縦順配置
- モバイル専用設計（レスポンシブ削除）
- 既存SCSSスタイルとの統合

#### 4.2 視覚的改善
- Hold/Goal比率の視覚化
- 投資進捗の分かりやすい表示
- 計算結果のリアルタイム反映

## 📝 実装順序

### Step 1: 画面構成修正（即座実行）
1. `pages/index.tsx`のAPI関連UI削除
2. `FormationSelector`追加
3. `StockInput`統合

### Step 2: BudgetManager実装（次段階）
1. `components/ui/BudgetManager.tsx`新規作成
2. 入力可能な予算管理機能

### Step 3: データフロー整理（最終段階）
1. 不要なAPI UI削除
2. バックグラウンド処理化
3. UI最適化

## 🎨 UI目標仕様

### レイアウト順序（仕様書準拠）
```
┌─────────────────────────────────┐
│ 1. Formation Selection          │ ← Select UI
├─────────────────────────────────┤
│ 2. Tier-based Stock Input       │ ← 動的Tier表示
│    ├ Tier1 (50%): $3,000       │
│    ├ Tier2 (30%): $1,800       │
│    └ Tier3 (20%): $1,200       │
├─────────────────────────────────┤
│ 3. Budget Management            │ ← 入力可能
│    ├ Funds: $6000              │
│    ├ Start: $xxxx              │
│    ├ Profit: $xxxx             │
│    └ Return: xx.x%              │
├─────────────────────────────────┤
│ 4. Formation Usage              │ ← シンプル表示
│    └ "3銘柄 50-30-20%型: XX%" │
└─────────────────────────────────┘
```

### 各Tier入力エリア仕様
```
Tier 1 (50% - $3,000)
├ Balance: 50%               │ ← 固定表示
├ Estimate: $3,000          │ ← 固定表示
├ Ticker: [Select AMZN▼]    │ ← Radix Select
├ Entry: [123.45]           │ ← 数値入力
└ Hold/Goal: 5/8            │ ← 表示+自動計算
```

## ✅ 成功基準

### 機能完全性
- [x] フォーメーション選択でTier数が動的変更
- [x] 各Tierでティッカー選択・価格入力・株数入力が可能
- [x] Goal株数の自動計算・Hold/Goal表示
- [x] 予算管理の入力・編集機能
- [x] シンプルなフォーメーション使用統計表示

### UI/UX品質
- [x] 仕様書通りの画面構成・順序
- [x] モバイル専用の使いやすいインターフェース
- [x] 数値キーボード対応の入力
- [x] リアルタイム計算反映

### 技術品質
- [x] 既存のZustand状態管理活用
- [x] Radix UIコンポーネントの適切な利用
- [x] 型安全性の確保
- [x] 不要なAPI UI削除

---

**総評**: 現在の実装は仕様書を無視してAPI統合部分だけに注力した結果、**メイン機能が全く実装されていない重大な状態**。根本的な再構築が必要。
