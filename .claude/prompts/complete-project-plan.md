````markdown
# サテライト投資管理アプリ 完全完成計画書

## 📋 プロジェクト概要

### 🎯 プロジェクト目標
6000ドルのサテライト投資資金を効率的に管理するためのWebアプリケーション。フォーメーション戦略に基づく資金配分と銘柄管理を行う完全機能型システムの構築。

### 📊 現状分析（2024年12月時点）

#### ✅ 完成済み項目
- **技術基盤**: Next.js 13.5 + TypeScript + Cloudflare Pages/D1
- **状態管理**: Zustand実装済み（appStore.ts）
- **データベース**: D1テーブル作成済み（settings, budget, holdings, formation_usage, formation_history）
- **API統合**: データ保存・読み込みAPI動作確認済み
- **自動保存機能**: Phase 3.1完了（ユーザーアクション時自動保存）
- **スタイリング基盤**: SCSS modules、BEMガイドライン準拠
- **UIコンポーネント**: Radix UIベース、一部実装済み

#### ❌ 重大な問題点
1. **画面構成の完全乖離**: 仕様書との整合性0%
2. **メイン機能の欠落**: Tier別銘柄入力、Goal計算等未実装
3. **不要機能の混入**: 手動API操作UI等の余計な実装
4. **コンポーネント統合不備**: StockInput作成済みだが未使用

## 🏗️ 完成計画

### Phase 1: UI基盤修正【緊急対応・1日】

#### 1.1 画面構成の仕様書準拠（優先度：最高） 済
**対象ファイル**: `pages/index.tsx`

**現在の構成（間違い）**:
```
1. APIデータ操作パネル（手動読み込み/保存/自動保存設定）
2. 読み取り専用予算表示
3. フォーメーション選択（パーセンテージ表示のみ）
4. フォーメーション使用統計
```

**正しい仕様書準拠構成**:
```
1. フォーメーション選択（FormationSelector）
2. Tier別銘柄入力セクション（StockInput - 動的表示）
3. 予算管理エリア（BudgetManager - 入力可能）
4. Formation Usage表示（シンプルテキスト）
```

**実装手順**:
1. 不要なAPI操作UI完全削除
2. FormationSelectorを上部に配置
3. 条件付きStockInput表示
4. BudgetManager統合
5. シンプルUsage表示

#### 1.2 FormationSelector新規作成 済
**ファイル**: `src/components/ui/FormationSelector.tsx`

**仕様**:
- Radix UI Select使用
- 5つのフォーメーション選択肢
- 選択時にZustandストア更新
- 下部Tier数の動的変更

**フォーメーション定義**:
- 3銘柄 50-30-20%型: 3000-1800-1200ドル
- 4銘柄 35-30-20-15%型: 2100-1800-1200-900ドル
- 5銘柄 30-25-20-15-10%型: 1800-1500-1200-900-600ドル
- フルポジ: 表示のみ
- ノーポジ: 表示のみ

#### 1.3 BudgetManager機能拡張 ✅ 済
**ファイル**: `src/components/ui/BudgetManager.tsx`（既存修正）

**追加機能**:
- ✅ Funds入力（デフォルト6000、変更可能）
- ✅ Start金額入力
- ✅ Profit金額入力
- ✅ Return%自動計算表示（常時表示）
- ❌ 即座自動保存対応
- ✅ 予算概要削除（重複情報のため不要）
- ✅ 利回り表示の常時表示化

### Phase 2: メイン機能実装【中核機能・2-3日】

#### 2.1 StockInput完全実装 済
**ファイル**: `src/components/ui/StockInput.tsx`（既存大幅修正）

**各Tier表示仕様**:
```
Tier X (xx% - $x,xxx)
├ Balance: xx%          # 固定表示
├ Estimate: $x,xxx      # 固定表示
├ Ticker: [Select]      # Radix Select（21銘柄）
├ Entry: [価格入力]      # 数値キーボード対応
├ Hold: [株数入力]       # 数値キーボード対応
└ Hold/Goal: x/x        # 自動計算＋表示
```

**計算ロジック**:
- Goal株数 = Estimate金額 ÷ Entry価格（四捨五入）
- リアルタイム計算・表示更新
- 入力時即座自動保存

**ティッカー選択肢**:
すでに設定済の内容利用

#### 2.2 動的Tier生成 済
**フォーメーション連動仕様**:
- 3銘柄選択時: Tier1-3表示
- 4銘柄選択時: Tier1-4表示
- 5銘柄選択時: Tier1-5表示
- フルポジ/ノーポジ: 入力エリア非表示

#### 2.3 計算エンジン実装 済
**ファイル**: `src/lib/utils/calculations.ts`（既存拡張）

**追加計算機能**:
- Goal株数計算（Estimate ÷ Entry価格）
- Return%計算（Profit ÷ Start × 100）
- ポートフォリオ合計値計算
- 投資進捗率計算

### Phase 3: データフロー最適化【品質向上・1-2日】

#### 3.1 自動保存機能完成 済
**対象範囲**:
- フォーメーション変更時
- 銘柄データ変更時（Ticker, Entry, Hold）
- 予算データ変更時（Funds, Start, Profit）



#### 3.2 不要機能の削除 済
**削除対象**:
- 手動データ読み込みボタン
- 手動データ保存ボタン
- 自動保存ON/OFFスイッチ
- 過剰なローディング表示
- 過剰なエラー表示

**保持機能**:
- バックグラウンド自動保存（非表示）
- 初期データ読み込み（非表示）
- 最低限のエラーハンドリング

#### 3.3 状態管理最適化 済
**ファイル**: `src/lib/utils/appStore.ts`

**最適化内容**:
- API関連状態の内部化
- UI必要状態のみ公開
- 型変換ロジック簡略化
- パフォーマンス改善

### Phase 4: UI/UX品質向上【仕上げ・1-2日】

#### 4.1 モバイル専用レイアウト調整 済
**対象**: 全スタイルファイル

**調整内容**:
- iPhone 12 Pro (390x844) 完全対応
- 縦順レイアウト最適化
- 数値キーボード対応入力
- タッチ操作最適化

#### 4.2 視覚的改善 済
**実装内容**:
- Hold/Goal比率の視覚化
- 投資進捗の分かりやすい表示
- 計算結果のリアルタイム反映
- 適切なフィードバック表示

#### 4.3 SCSS統合
**ガイドライン準拠**:
- BEM methodology適用
- 7-layer architecture準拠
- CSS modules活用
- docs/styling guides遵守

### Phase 5: 本番環境準備【デプロイ・1日】

#### 5.1 Cloudflare環境設定
**対象**:
- D1本番データベース作成
- Pages本番デプロイ設定
- 環境変数設定
- Cron Triggers設定

#### 5.2 最終品質確認
**確認項目**:
- 全機能動作確認
- iPhone実機テスト
- パフォーマンステスト
- セキュリティ確認

## 📅 実装スケジュール

### 即座実行（緊急対応）
- **Day 1**: Phase 1完了（UI基盤修正）
  - 8:00-12:00: 画面構成修正
  - 13:00-17:00: FormationSelector実装
  - 18:00-20:00: BudgetManager機能拡張

### 中期実装
- **Day 2-4**: Phase 2完了（メイン機能実装）
  - StockInput完全実装
  - 動的Tier生成
  - 計算エンジン実装

### 最終仕上げ
- **Day 5-7**: Phase 3-5完了
  - データフロー最適化
  - UI/UX品質向上
  - 本番環境準備

## ✅ 成功基準

### 機能完全性
- [ ] フォーメーション選択でTier数が動的変更
- [ ] 各Tierでティッカー選択・価格入力・株数入力が可能
- [ ] Goal株数の自動計算・Hold/Goal表示
- [ ] 予算管理の入力・編集機能
- [ ] シンプルなフォーメーション使用統計表示
- [ ] ユーザーアクション時の自動保存

### UI/UX品質
- [ ] 仕様書通りの画面構成・順序
- [ ] iPhone 12 Pro (390x844) 完全対応
- [ ] 数値キーボード対応の入力
- [ ] リアルタイム計算反映
- [ ] 直感的な操作性

### 技術品質
- [ ] 既存のZustand状態管理活用
- [ ] Radix UIコンポーネントの適切な利用
- [ ] 型安全性の確保
- [ ] 不要なAPI UI完全削除
- [ ] docs/ガイドライン100%準拠

### 本番品質
- [ ] Cloudflare Pages正常デプロイ
- [ ] D1データベース正常動作
- [ ] 自動保存機能動作確認
- [ ] Cron Triggers設定完了
- [ ] セキュリティ要件満足

## 🚨 開発時の絶対遵守事項

### 🔴 最重要事項：不要な変更の完全禁止

**以下の行為は一切禁止。違反は開発の完全停止とする：**

1. **指示されていない変更の禁止**
   - 明確に指示されたコンポーネント以外への変更禁止
   - 指示されたPhase以外の実装禁止
   - 「ついでに」「改善のため」の変更完全禁止

2. **変更前の状態保存義務**
   - 修正前に必ずスクリーンショット撮影
   - 修正後に必ず比較確認
   - 意図しない変更発見時は即座に修正

3. **影響範囲の厳密な限定**
   - 修正対象ファイルの事前確認
   - スタイリング変更時の影響範囲確認
   - 他コンポーネントへの影響ゼロの確認

4. **段階的実装の厳守**
   - Phase 1.1 → 1.2 → 1.3の順序厳守
   - 各Phase完了時の動作確認必須
   - 次Phase開始前の状態確認必須

**違反例（絶対禁止）：**
- FormationSelector修正時にStockInputのスタイルを変更
- Phase 1.2指示時にPhase 1.3を勝手に実装
- Tierバッジのデザインを指示なく変更
- 「改善」を理由とした無許可の変更

**遵守確認方法：**
- 修正前後のスクリーンショット比較
- playwright MCPでの実際動作確認
- 指示された範囲外の変更ゼロの確認

### 必須確認プロセス
1. **修正前後の開発者ツール確認**
2. **iPhone 12 Pro エミュレート確認**
3. **スクリーンショット証拠撮影**
4. **実機能動作確認**
5. **事実のみ報告（推測禁止）**

### 禁止事項
- 推測・憶測でのレスポンス
- 実際の確認なしでの「完了」報告
- 責任逃れのための技術的言い訳
- docs/ガイドライン違反

## 📁 重要ファイル参照

### 設計ドキュメント
- `/Users/hsmtrychmba/Desktop/00_document.md` - 原本仕様書
- `.claude/prompts/ui-analysis-and-fix-plan.md` - 問題分析＆修正計画
- `docs/development-critical-rules.md` - 開発時絶対遵守ルール

### 開発ガイドライン
- `docs/scss-styling-guide.md` - スタイリング指針
- `docs/file-naming-standards-ts.md` - TypeScript命名規則
- `docs/jsdoc-component-guide.md` - コンポーネント文書化

### 技術設定
- `playwright.config.js` - iPhone 12 Pro (390x844) 設定
- `wrangler.toml` - Cloudflare環境設定
- `src/lib/utils/schema.ts` - データベーススキーマ

## 📊 最終成果物

### アプリケーション機能
1. **完全動作するフォーメーション選択システム**
2. **動的Tier別銘柄入力システム**
3. **リアルタイム計算エンジン**
4. **自動保存データ管理システム**
5. **iPhone完全対応モバイルUI**

### 技術品質
1. **型安全TypeScriptコード**
2. **Cloudflare Pages/D1完全統合**
3. **docs/ガイドライン100%準拠**
4. **保守可能な設計構造**
5. **拡張性確保済みアーキテクチャ**

---

**作成日**: 2024年12月25日
**最終更新**: 2024年12月25日
**ステータス**: Phase 1即座実行待ち

**備考**: 本計画書は`00_document.md`原本仕様書、`ui-analysis-and-fix-plan.md`問題分析、`development-critical-rules.md`開発規則に完全準拠して作成。

````
